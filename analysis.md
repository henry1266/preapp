# realtime_prescriptions.ejs 分析報告

## 檔案概述
- 檔案路徑：`/home/ubuntu/projects/preapp/views/realtime_prescriptions.ejs`
- 檔案大小：37608 bytes
- 主要功能：即時處方顯示與互動介面，包含處方資訊顯示、藥品選取、覆核功能等

## 結構分析

### 1. HTML 結構
- 基本 HTML5 文檔結構
- 主要區塊：
  - 頁面標題區
  - 按鈕控制區（取消、改單、查詢紀錄）
  - 處方紀錄模態視窗
  - 藥品覆核對話框
  - 左右雙欄內容區（左側處方詳情，右側處方ID與備註）

### 2. CSS 樣式
- 內嵌大量 CSS 樣式（約 250 行）
- 包含多種元素樣式：基本版面、表格、按鈕、模態視窗、動畫效果等
- 包含響應式設計（@media 查詢）

### 3. JavaScript 功能
- Socket.IO 即時通訊
- DOM 操作與事件處理
- 處方資料渲染
- 模態視窗控制
- 藥品覆核流程
- 動畫與特效
- 截圖功能（html2canvas）

## 肥腫問題分析

### 1. 樣式混合問題
- 大量 CSS 樣式直接內嵌於 HTML 中，造成檔案臃腫
- 樣式與結構混合，難以維護與更新

### 2. 功能耦合問題
- 多個不同功能的 JavaScript 邏輯混合在同一個 script 標籤中
- 事件處理、資料處理、UI 渲染等功能未分離

### 3. 模板結構問題
- 缺乏組件化思維，整個頁面寫在單一檔案中
- 模態視窗、表格等重複使用的元素未抽離為獨立組件

## 可拆分點

### 1. CSS 樣式拆分
- 將所有 CSS 樣式抽離為外部檔案
- 按功能區分為多個 CSS 檔案：基本樣式、模態視窗樣式、表格樣式、響應式樣式等

### 2. JavaScript 功能拆分
- 將 JavaScript 功能模組化，拆分為多個檔案
- 按功能區分：Socket 連接、處方渲染、模態視窗控制、藥品覆核等

### 3. HTML 結構拆分
- 將模態視窗、對話框等獨立為 EJS partials
- 將左右欄內容區域模板化

## 優化建議

### 1. 樣式優化
- 創建外部 CSS 檔案，按功能分類
- 使用 CSS 變數統一管理顏色、間距等屬性
- 優化選擇器，減少重複樣式

### 2. 結構優化
- 創建 EJS partials 目錄，拆分模態視窗、表格等組件
- 使用 EJS include 引入各組件
- 保持主檔案簡潔，只包含頁面骨架

### 3. 功能優化
- 創建 JavaScript 模組，按功能分類
- 使用事件委派減少事件監聽器數量
- 優化資料處理邏輯，減少重複代碼

## 拆分計劃
1. 創建 CSS 目錄與檔案
2. 創建 JavaScript 模組目錄與檔案
3. 創建 EJS partials 目錄與檔案
4. 重構主檔案，引入拆分後的組件
5. 測試功能完整性
